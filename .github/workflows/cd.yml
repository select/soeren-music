name: Continuous Deployment to demo.coverz.com

on:
	push:
		branches: production

jobs:
	deploy_job:
		runs-on: ubuntu-latest
		name: deploy
		steps:
		- uses: actions/checkout@master
		- name: Use Node.js 12.x
			uses: actions/setup-node@v1
			with:
				node-version: '12.x'
		- name: Build Project
			run:
				npm ci
				npm run generate
		- name: deploy file
			uses: wlixcc/SFTP-Deploy-Action@v1.0
			with:
				username: ${{ secrets.SSH_USER }}
				server: ${{ secrets.SSH_SERVER }}
				port: ${{ secrets.SSH_PORT }}
				ssh_private_key: ${{ secrets.SSH_PRIVATE_KEY }}
				local_path: './dist/*'
				remote_path: "/home/${{ secrets.SSH_USER }}/www"
				args: '-o ConnectTimeout=5'
		# - name: send message to matrix
		# 	uses: s3krit/matrix-message-action@v0.0.3
		# 	with:
		# 		room_id: ${{ secrets.MATRIX_ROOM_ID }}
		# 		access_token: ${{ secrets.MATRIX_ACCESS_TOKEN }}
		# 		message: "${{ github.event.pusher.name}} pushed commits to ${{ github.event.repository.name }}:  \n ${{ join(github.event.commits.*.message, '  \n')  }}  \nVisit http://demo.coverz.com to check it out."
		# 		server: "matrix.org"
